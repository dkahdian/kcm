import{d as za,a as _t,r as Ka,b as Va,P as Ha,T as Xa,Q as Ga,e as ue,i as ce,M as Je,c as Wa,v as Ja,p as Ya,f as Mt,g as ra,C as ia,s as oa,h as sa,j as la,l as qt,k as Za}from"../chunks/Dx1f_i_t.js";import"../chunks/DsnmJJEf.js";import{s as N,o as $a}from"../chunks/D4xMwpl8.js";import{a$ as en,aT as tn,u as an,r as nn,h as rn,k as ft,be as on,ba as nt,K as He,X as T,y as Fe,a4 as Pe,z as n,v as e,Z as Ve,_ as Ke,Q as _,R as Xe,M as k,V as i,Y as r,al as at,T as o,bf as mt,O as C,aW as j,aX as sn,a0 as ln,bg as da,N as dn,bh as un,$ as cn}from"../chunks/CuxRnwIY.js";import{p as pe,i as B}from"../chunks/CTb7Me_4.js";import{r as Ye,s as ze,b as ot,a as Be,c as gn}from"../chunks/BQmAUj6M.js";function Ue(s,t,l=t){var c=new WeakSet;en(s,"input",async v=>{var m=v?s.defaultValue:s.value;if(m=Ot(s)?jt(m):m,l(m),ft!==null&&c.add(ft),await tn(),m!==(m=t())){var u=s.selectionStart,b=s.selectionEnd;s.value=m??"",b!==null&&(s.selectionStart=u,s.selectionEnd=Math.min(b,s.value.length))}}),(rn&&s.defaultValue!==s.value||an(t)==null&&s.value)&&(l(Ot(s)?jt(s.value):s.value),ft!==null&&c.add(ft)),nn(()=>{var v=t();if(s===document.activeElement){var m=on??ft;if(c.has(m))return}Ot(s)&&v===jt(s.value)||s.type==="date"&&!v&&!s.value||v!==s.value&&(s.value=v??"")})}function Ot(s){var t=s.type;return t==="number"||t==="range"}function jt(s){return s===""?null:+s}const pa={},vn=za.separatingFunctions;for(const s of vn)pa[s.shortName]=s;const fn=Object.values(pa),bn=()=>{const s=_t.map(u=>u.name),t=new Map;for(const u of _t)if(u.references)for(const b of u.references)t.has(b.id)||t.set(b.id,b.title);const l=Array.from(t.entries()).map(([u,b])=>({id:u,title:b})),c=new Map;for(const u of _t)if(u.tags)for(const b of u.tags)c.has(b.label)||c.set(b.label,{label:b.label,color:b.color});const v=Array.from(c.values()),m=fn.map(u=>({shortName:u.shortName,name:u.name,description:u.description}));return{existingLanguageIds:s,existingReferences:l,existingSeparatingFunctions:m,existingTags:v,languages:_t,queries:Ga,transformations:Xa,polytimeOptions:Ha,adjacencyMatrix:Va,relationTypes:Ka}},mn=!1,_i=Object.freeze(Object.defineProperty({__proto__:null,load:bn,prerender:mn},Symbol.toStringTag,{value:"Module"}));async function pn(s,t,l,c,v,m,u,b,x,S,I,g){if(!e(t).trim()||!e(l).trim()||!e(c).trim()){n(v,"Please fill out all required fields.");return}try{const p=await m.onAdd({name:e(t).trim(),fullName:e(l).trim(),description:e(c).trim(),descriptionRefs:e(u),queries:e(b),transformations:e(x),tags:e(S),existingReferences:e(I)}),y=p&&typeof p=="object"&&"success"in p?p:void 0;if(y&&!y.success){n(v,y.error??"Unable to add language. Please review your input.",!0);return}n(v,null),g(),m.onClose?.()}catch(p){n(v,p instanceof Error?p.message:"Unexpected error while adding the language.",!0)}}function ua(s,t,l){t(),l.onClose()}var xn=s=>s.stopPropagation(),_n=k('<div class="p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700"> </div>'),yn=(s,t,l)=>t(e(l)),hn=k('<button type="button"> </button>'),wn=k('<fieldset><legend class="block text-sm font-medium text-gray-700 mb-2">Description References</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),En=k("<option> </option>"),kn=(s,t,l,c)=>t(e(l).code,e(c)),Rn=k('<button type="button"> </button>'),Sn=k('<div class="mt-2 flex flex-wrap gap-1"></div>'),In=k('<div class="p-3 bg-gray-50 rounded-lg border border-gray-200"><div class="grid grid-cols-1 md:grid-cols-2 gap-3"><div><label class="block text-xs font-medium text-gray-700 mb-1"> </label> <select class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500"></select></div> <div><label class="block text-xs font-medium text-gray-700 mb-1">Note</label> <input type="text" placeholder="Optional note..." class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500"/></div></div> <!></div>'),Fn=k("<option> </option>"),Tn=(s,t,l,c)=>t(e(l).code,e(c)),Dn=k('<button type="button"> </button>'),An=k('<div class="mt-2 flex flex-wrap gap-1"></div>'),Nn=k('<div class="p-3 bg-gray-50 rounded-lg border border-gray-200"><div class="grid grid-cols-1 md:grid-cols-2 gap-3"><div><label class="block text-xs font-medium text-gray-700 mb-1"> </label> <select class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500"></select></div> <div><label class="block text-xs font-medium text-gray-700 mb-1">Note</label> <input type="text" placeholder="Optional note..." class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-green-500"/></div></div> <!></div>'),Ln=(s,t,l)=>t(e(l)),Mn=k('<button type="button"> </button>'),On=k('<div class="space-y-4 border-t pt-6"><h3 class="text-lg font-bold text-gray-900">Tags</h3> <div class="flex flex-wrap gap-2"></div></div>'),jn=k(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"><div class="bg-gradient-to-r from-green-600 to-green-700 px-6 py-4 sticky top-0 z-10"><h2 class="text-2xl font-bold text-white"> </h2> <p class="text-green-100 mt-1">Define a knowledge compilation language</p></div> <div class="p-6 space-y-6"><!> <div class="space-y-4"><h3 class="text-lg font-bold text-gray-900">Basic Information</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="lang-name" class="block text-sm font-medium text-gray-700 mb-1">Short Name <span class="text-red-500">*</span></label> <input type="text" id="lang-name" placeholder="e.g., 'OBDD', 'd-DNNF'" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"/></div> <div><label for="lang-fullname" class="block text-sm font-medium text-gray-700 mb-1">Full Name <span class="text-red-500">*</span></label> <input type="text" id="lang-fullname" placeholder="e.g., 'Ordered Binary Decision Diagrams'" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"/></div></div> <div><label for="lang-description" class="block text-sm font-medium text-gray-700 mb-1">Description <span class="text-red-500">*</span></label> <textarea id="lang-description" placeholder="Brief description of this language..." rows="3" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"></textarea></div> <!></div> <div class="space-y-4 border-t pt-6"><h3 class="text-lg font-bold text-gray-900">Query Support</h3> <div class="space-y-3"></div></div> <div class="space-y-4 border-t pt-6"><h3 class="text-lg font-bold text-gray-900">Transformation Support</h3> <div class="space-y-3"></div></div> <!> <div class="flex gap-3 justify-end pt-6 border-t sticky bottom-0 bg-white"><button type="button" class="px-4 py-2 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="button" class="px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"> </button></div></div></div></div>`);function ca(s,t){He(t,!0);let l=pe(t,"isOpen",11,!1),c=pe(t,"availableRefs",19,()=>[]),v=pe(t,"isEdit",3,!1),m=T(""),u=T(""),b=T(""),x=T(Fe([])),S=T(Fe({})),I=T(Fe({})),g=T(Fe([])),p=T(Fe([])),y=T(null);Pe(()=>{v()&&t.initialData&&(n(m,t.initialData.name,!0),n(u,t.initialData.fullName,!0),n(b,t.initialData.description,!0),n(x,[...t.initialData.descriptionRefs],!0),n(S,{...t.initialData.queries},!0),n(I,{...t.initialData.transformations},!0),n(g,[...t.initialData.tags],!0),n(p,[...t.initialData.existingReferences],!0),n(y,null))});function h(){n(m,""),n(u,""),n(b,""),n(x,[],!0),n(S,{},!0),n(I,{},!0),n(g,[],!0),n(p,[],!0),n(L,!1),n(H,!1),n(y,null)}function O(E){e(x).includes(E)?n(x,e(x).filter(f=>f!==E),!0):n(x,[...e(x),E],!0)}function te(E){e(g).some(f=>f.label===E.label)?n(g,e(g).filter(f=>f.label!==E.label),!0):n(g,[...e(g),E],!0)}function ae(E,f){if(!e(S)[E])return;const R=e(S)[E].refs;R.includes(f)?e(S)[E].refs=R.filter(U=>U!==f):e(S)[E].refs=[...R,f],n(S,{...e(S)},!0)}function Q(E,f){if(!e(I)[E])return;const R=e(I)[E].refs;R.includes(f)?e(I)[E].refs=R.filter(U=>U!==f):e(I)[E].refs=[...R,f],n(I,{...e(I)},!0)}let L=T(!1),H=T(!1);Pe(()=>{if(t.queries.length>0&&!e(L)){const E={};t.queries.forEach(f=>{if(v()&&t.initialData&&t.initialData.queries[f.code]){const R=t.initialData.queries[f.code];E[f.code]={polytime:R.polytime,note:R.note||"",refs:[...R.refs]}}else E[f.code]={polytime:"unknown",note:"",refs:[]}}),n(S,E,!0),n(L,!0)}}),Pe(()=>{if(t.transformations.length>0&&!e(H)){const E={};t.transformations.forEach(f=>{if(v()&&t.initialData){let R=t.initialData.transformations[f.code];if(!R){const U=Object.keys(t.initialData.transformations).find(M=>t.initialData.transformations[M]!==void 0&&(M===f.code||f.code==="∧C"&&M==="AND_C"||f.code==="∧BC"&&M==="AND_BC"||f.code==="∨C"&&M==="OR_C"||f.code==="∨BC"&&M==="OR_BC"||f.code==="¬C"&&M==="NOT_C"));U&&(R=t.initialData.transformations[U])}E[f.code]=R?{polytime:R.polytime,note:R.note||"",refs:[...R.refs]}:{polytime:"unknown",note:"",refs:[]}}else E[f.code]={polytime:"unknown",note:"",refs:[]}}),n(I,E,!0),n(H,!0)}});var $=Ve(),ne=Ke($);{var G=E=>{var f=jn();f.__click=[ua,h,t];var R=i(f);R.__click=[xn];var U=i(R),M=i(U),W=i(M);r(M),at(2),r(U);var z=o(U,2),re=i(z);{var oe=P=>{var q=_n(),De=i(q,!0);r(q),C(()=>N(De,e(y))),_(P,q)};B(re,P=>{e(y)&&P(oe)})}var xe=o(re,2),be=o(i(xe),2),ee=i(be),_e=o(i(ee),2);Ye(_e),r(ee);var ge=o(ee,2),J=o(i(ge),2);Ye(J),r(ge),r(be);var se=o(be,2),ve=o(i(se),2);mt(ve),r(se);var le=o(se,2);{var Te=P=>{var q=wn(),De=o(i(q),2);ue(De,21,c,ce,(Re,fe)=>{var ie=hn();ie.__click=[yn,O,fe];var Ae=i(ie,!0);r(ie),C(Se=>{Be(ie,1,Se),N(Ae,e(fe))},[()=>`px-3 py-1 text-sm rounded-lg border-2 transition-colors ${e(x).includes(e(fe))?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 border-gray-300 hover:border-green-300"}`]),_(Re,ie)}),r(De),r(q),_(P,q)};B(le,P=>{c().length>0&&P(Te)})}r(xe);var Ee=o(xe,2),Oe=o(i(Ee),2);ue(Oe,21,()=>t.queries,ce,(P,q)=>{var De=Ve(),Re=Ke(De);{var fe=ie=>{var Ae=In(),Se=i(Ae),je=i(Se),Ce=i(je),rt=i(Ce,!0);r(Ce);var Qe=o(Ce,2);ue(Qe,21,()=>t.polytimeOptions,ce,(he,Ne)=>{var Le=En(),qe=i(Le,!0);r(Le);var Ie={};C(()=>{N(qe,e(Ne).label),Ie!==(Ie=e(Ne).value)&&(Le.value=(Le.__value=e(Ne).value)??"")}),_(he,Le)}),r(Qe),r(je);var $e=o(je,2),et=i($e),Ge=o(et,2);Ye(Ge),r($e),r(Se);var st=o(Se,2);{var lt=he=>{var Ne=Sn();ue(Ne,21,c,ce,(Le,qe)=>{var Ie=Rn();Ie.__click=[kn,ae,q,qe];var dt=i(Ie,!0);r(Ie),C(ut=>{Be(Ie,1,ut),N(dt,e(qe))},[()=>`px-2 py-0.5 text-xs rounded ${e(S)[e(q).code].refs.includes(e(qe))?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`]),_(Le,Ie)}),r(Ne),_(he,Ne)};B(st,he=>{c().length>0&&he(lt)})}r(Ae),C(()=>{ze(Ce,"for",`query-${e(q).code??""}-polytime`),N(rt,e(q).name),ze(Qe,"id",`query-${e(q).code??""}-polytime`),ze(et,"for",`query-${e(q).code??""}-note`),ze(Ge,"id",`query-${e(q).code??""}-note`)}),ot(Qe,()=>e(S)[e(q).code].polytime,he=>e(S)[e(q).code].polytime=he),Ue(Ge,()=>e(S)[e(q).code].note,he=>e(S)[e(q).code].note=he),_(ie,Ae)};B(Re,ie=>{e(S)[e(q).code]&&ie(fe)})}_(P,De)}),r(Oe),r(Ee);var Me=o(Ee,2),K=o(i(Me),2);ue(K,21,()=>t.transformations,ce,(P,q)=>{var De=Ve(),Re=Ke(De);{var fe=ie=>{var Ae=Nn(),Se=i(Ae),je=i(Se),Ce=i(je),rt=i(Ce,!0);r(Ce);var Qe=o(Ce,2);ue(Qe,21,()=>t.polytimeOptions,ce,(he,Ne)=>{var Le=Fn(),qe=i(Le,!0);r(Le);var Ie={};C(()=>{N(qe,e(Ne).label),Ie!==(Ie=e(Ne).value)&&(Le.value=(Le.__value=e(Ne).value)??"")}),_(he,Le)}),r(Qe),r(je);var $e=o(je,2),et=i($e),Ge=o(et,2);Ye(Ge),r($e),r(Se);var st=o(Se,2);{var lt=he=>{var Ne=An();ue(Ne,21,c,ce,(Le,qe)=>{var Ie=Dn();Ie.__click=[Tn,Q,q,qe];var dt=i(Ie,!0);r(Ie),C(ut=>{Be(Ie,1,ut),N(dt,e(qe))},[()=>`px-2 py-0.5 text-xs rounded ${e(I)[e(q).code].refs.includes(e(qe))?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`]),_(Le,Ie)}),r(Ne),_(he,Ne)};B(st,he=>{c().length>0&&he(lt)})}r(Ae),C(()=>{ze(Ce,"for",`transform-${e(q).code??""}-polytime`),N(rt,e(q).name),ze(Qe,"id",`transform-${e(q).code??""}-polytime`),ze(et,"for",`transform-${e(q).code??""}-note`),ze(Ge,"id",`transform-${e(q).code??""}-note`)}),ot(Qe,()=>e(I)[e(q).code].polytime,he=>e(I)[e(q).code].polytime=he),Ue(Ge,()=>e(I)[e(q).code].note,he=>e(I)[e(q).code].note=he),_(ie,Ae)};B(Re,ie=>{e(I)[e(q).code]&&ie(fe)})}_(P,De)}),r(K),r(Me);var Y=o(Me,2);{var V=P=>{var q=On(),De=o(i(q),2);ue(De,21,()=>t.existingTags,ce,(Re,fe)=>{var ie=Mn();ie.__click=[Ln,te,fe];var Ae=i(ie,!0);r(ie),C((Se,je)=>{Be(ie,1,Se),gn(ie,`background-color: ${e(fe).color??""}; color: white; ${je??""}`),N(Ae,e(fe).label)},[()=>`px-3 py-1 rounded-full text-sm font-medium transition-all ${e(g).some(Se=>Se.label===e(fe).label)?"ring-2 ring-offset-2":"opacity-60 hover:opacity-100"}`,()=>e(g).some(Se=>Se.label===e(fe).label)?`ring-color: ${e(fe).color};`:""]),_(Re,ie)}),r(De),r(q),_(P,q)};B(Y,P=>{t.existingTags.length>0&&P(V)})}var we=o(Y,2),Z=i(we);Z.__click=[ua,h,t];var de=o(Z,2);de.__click=[pn,m,u,b,y,t,x,S,I,g,p,h];var ke=i(de);r(de),r(we),r(z),r(R),r(f),C(P=>{N(W,`${v()?"Edit":"Add New"} Language`),de.disabled=P,N(ke,`${v()?"Update":"Add"} Language`)},[()=>!e(m).trim()||!e(u).trim()||!e(b).trim()]),Ue(_e,()=>e(m),P=>n(m,P)),Ue(J,()=>e(u),P=>n(u,P)),Ue(ve,()=>e(b),P=>n(b,P)),_(E,f)};B(ne,E=>{l()&&E(G)})}_(s,$),Xe()}nt(["click"]);function Cn(s,t,l,c){e(t).trim()&&(l.onAdd(e(t).trim()),n(t,""),c(!1))}function ga(s,t,l,c){t()||n(l,""),c.onClose()}var qn=s=>s.stopPropagation(),Un=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"><div class="bg-gradient-to-r from-purple-600 to-purple-700 px-6 py-4"><h2 class="text-2xl font-bold text-white"> </h2> <p class="text-purple-100 mt-1"> </p></div> <div class="p-6 space-y-4"><div><label for="bibtex-input" class="block text-sm font-medium text-gray-700 mb-2">BibTeX Entry <span class="text-red-500">*</span></label> <textarea id="bibtex-input" rows="8" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 font-mono text-sm"></textarea> <p class="text-xs text-gray-500 mt-1">Paste a complete BibTeX entry.</p></div> <div class="flex gap-3 justify-end pt-4"><button type="button" class="px-4 py-2 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="button" class="px-4 py-2 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"> </button></div></div></div></div>');function Pn(s,t){He(t,!0);let l=pe(t,"isOpen",15,!1),c=pe(t,"initialValue",3,""),v=pe(t,"isEditMode",3,!1),m=T(Fe(c()));Pe(()=>{l()&&c()&&n(m,c())});const u=`@article{Darwiche_2002,
  title={A Knowledge Compilation Map},
  author={Darwiche, Adnan and Marquis, Pierre},
  journal={Journal of AI Research},
  year={2002}
}`;var b=Ve(),x=Ke(b);{var S=I=>{var g=Un();g.__click=[ga,v,m,t];var p=i(g);p.__click=[qn];var y=i(p),h=i(y),O=i(h,!0);r(h);var te=o(h,2),ae=i(te,!0);r(te),r(y);var Q=o(y,2),L=i(Q),H=o(i(L),2);mt(H),ze(H,"placeholder",u),at(2),r(L);var $=o(L,2),ne=i($);ne.__click=[ga,v,m,t];var G=o(ne,2);G.__click=[Cn,m,t,l];var E=i(G,!0);r(G),r($),r(Q),r(p),r(g),C(f=>{N(O,v()?"Edit Reference":"Add New Reference"),N(ae,v()?"Update BibTeX citation":"Paste BibTeX citation"),G.disabled=f,N(E,v()?"Update Reference":"Add Reference")},[()=>!e(m).trim()]),Ue(H,()=>e(m),f=>n(m,f)),_(I,g)};B(x,I=>{l()&&I(S)})}_(s,b),Xe()}nt(["click"]);function Bn(s,t,l,c,v,m,u,b,x){!e(t).trim()||!e(l).trim()||(c.onAdd({shortName:e(t).trim(),name:e(l).trim(),description:e(v).trim(),refs:e(m)}),u()||b(),x(!1))}function va(s,t,l,c){t()||l(),c.onClose()}var Qn=s=>s.stopPropagation(),zn=(s,t,l)=>t(e(l)),Kn=k('<button type="button"> </button>'),Vn=k('<fieldset><legend class="block text-sm font-medium text-gray-700 mb-2">References</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),Hn=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"><div class="bg-gradient-to-r from-orange-600 to-orange-700 px-6 py-4"><h2 class="text-2xl font-bold text-white"> </h2> <p class="text-orange-100 mt-1"> </p></div> <div class="p-6 space-y-4"><div><label for="sf-shortName" class="block text-sm font-medium text-gray-700 mb-2">Short Name <span class="text-red-500">*</span></label> <input id="sf-shortName" type="text" placeholder="e.g., Clique" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"/> <p class="text-xs text-gray-500 mt-1">Brief label displayed on edges (e.g., "Clique", "PI")</p></div> <div><label for="sf-name" class="block text-sm font-medium text-gray-700 mb-2">Full Name <span class="text-red-500">*</span></label> <input id="sf-name" type="text" placeholder="e.g., Clique Detection Instances" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"/> <p class="text-xs text-gray-500 mt-1">Full human-readable name</p></div> <div><label for="sf-description" class="block text-sm font-medium text-gray-700 mb-2">Description</label> <textarea id="sf-description" rows="3" placeholder="Describe what this function separates..." class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-y"></textarea></div> <!> <div class="flex gap-3 justify-end pt-4"><button type="button" class="px-4 py-2 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="button" class="px-4 py-2 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"> </button></div></div></div></div>');function Xn(s,t){He(t,!0);let l=pe(t,"isOpen",15,!1),c=pe(t,"availableRefs",19,()=>[]),v=pe(t,"isEditMode",3,!1),m=T(""),u=T(""),b=T(""),x=T(Fe([]));Pe(()=>{l()&&t.initialValue&&(n(m,t.initialValue.shortName,!0),n(u,t.initialValue.name,!0),n(b,t.initialValue.description,!0),n(x,[...t.initialValue.refs],!0))});function S(){n(m,""),n(u,""),n(b,""),n(x,[],!0)}function I(h){e(x).includes(h)?n(x,e(x).filter(O=>O!==h),!0):n(x,[...e(x),h],!0)}var g=Ve(),p=Ke(g);{var y=h=>{var O=Hn();O.__click=[va,v,S,t];var te=i(O);te.__click=[Qn];var ae=i(te),Q=i(ae),L=i(Q,!0);r(Q);var H=o(Q,2),$=i(H,!0);r(H),r(ae);var ne=o(ae,2),G=i(ne),E=o(i(G),2);Ye(E),at(2),r(G);var f=o(G,2),R=o(i(f),2);Ye(R),at(2),r(f);var U=o(f,2),M=o(i(U),2);mt(M),r(U);var W=o(U,2);{var z=ee=>{var _e=Vn(),ge=o(i(_e),2);ue(ge,21,c,ce,(J,se)=>{var ve=Kn();ve.__click=[zn,I,se];var le=i(ve,!0);r(ve),C(Te=>{Be(ve,1,Te),N(le,e(se))},[()=>`px-3 py-1 text-sm rounded-lg border-2 transition-colors ${e(x).includes(e(se))?"bg-orange-600 text-white border-orange-600":"bg-white text-gray-700 border-gray-300 hover:border-orange-300"}`]),_(J,ve)}),r(ge),r(_e),_(ee,_e)};B(W,ee=>{c().length>0&&ee(z)})}var re=o(W,2),oe=i(re);oe.__click=[va,v,S,t];var xe=o(oe,2);xe.__click=[Bn,m,u,t,b,x,v,S,l];var be=i(xe,!0);r(xe),r(re),r(ne),r(te),r(O),C(ee=>{N(L,v()?"Edit Separating Function":"Add New Separating Function"),N($,v()?"Update separating function details":"Define a new separating function"),xe.disabled=ee,N(be,v()?"Update Function":"Add Function")},[()=>!e(m).trim()||!e(u).trim()]),Ue(E,()=>e(m),ee=>n(m,ee)),Ue(R,()=>e(u),ee=>n(u,ee)),Ue(M,()=>e(b),ee=>n(b,ee)),_(h,O)};B(p,h=>{l()&&h(y)})}_(s,g),Xe()}nt(["click"]);function Gn(s,t,l,c,v,m,u,b,x,S){!e(t)||!e(l)||!e(c)||e(t)===e(l)||(v.onSave({sourceId:e(t),targetId:e(l),status:e(c),description:e(m)||void 0,refs:e(u),separatingFunctionIds:e(b).length>0?e(b):void 0}),x(),S(!1))}function fa(s,t,l){t(),l.onClose()}var Wn=s=>s.stopPropagation(),Jn=k("<option> </option>"),Yn=k("<option> </option>"),Zn=k("<option> </option>"),$n=k('<p class="text-xs text-gray-500 mt-1"> </p>'),er=(s,t,l)=>t(e(l)),tr=k('<button type="button"> </button>'),ar=k('<fieldset><legend class="block text-sm font-medium text-gray-700 mb-2">References</legend> <div class="flex flex-wrap gap-2"></div></fieldset>'),nr=(s,t,l)=>t(e(l).shortName),rr=k('<button type="button"> </button>'),ir=k('<p class="text-xs text-gray-500 mt-2"> </p>'),or=k('<fieldset class="border-t pt-4"><legend class="block text-sm font-medium text-gray-700 mb-2">Separating Functions (optional)</legend> <div class="flex flex-wrap gap-2"></div> <!></fieldset>'),sr=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"><div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 sticky top-0 z-10"><h2 class="text-2xl font-bold text-white">Manage Relationship</h2> <p class="text-blue-100 mt-1">Add or update transformation relationships</p></div> <div class="p-6 space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="rel-source" class="block text-sm font-medium text-gray-700 mb-1">Source Language <span class="text-red-500">*</span></label> <select id="rel-source" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>Select source...</option><!></select></div> <div><label for="rel-target" class="block text-sm font-medium text-gray-700 mb-1">Target Language <span class="text-red-500">*</span></label> <select id="rel-target" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>Select target...</option><!></select></div></div> <div><label for="rel-status" class="block text-sm font-medium text-gray-700 mb-1">Classification <span class="text-red-500">*</span></label> <select id="rel-status" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>Select classification...</option><!></select> <!></div> <div><label for="rel-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label> <textarea id="rel-description" rows="3" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-y" placeholder="Describe this transformation relationship (optional)..."></textarea></div> <!> <!> <div class="flex gap-3 justify-end pt-4 border-t"><button type="button" class="px-4 py-2 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="button" class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">Save Relationship</button></div></div></div></div>');function lr(s,t){He(t,!0);let l=pe(t,"isOpen",15,!1),c=pe(t,"availableRefs",19,()=>[]),v=pe(t,"availableSeparatingFunctions",19,()=>[]),m=pe(t,"baselineRelations",19,()=>new Map),u=T(""),b=T(""),x=T(""),S=T(""),I=T(Fe([])),g=T(Fe([]));Pe(()=>{l()&&t.initialData&&(n(u,t.initialData.sourceId,!0),n(b,t.initialData.targetId,!0),n(x,t.initialData.status,!0),n(S,t.initialData.description||"",!0),n(I,[...t.initialData.refs],!0),t.initialData.separatingFunctionIds?n(g,[...t.initialData.separatingFunctionIds],!0):t.initialData.separatingFunctions?n(g,t.initialData.separatingFunctions.map(Q=>Q.shortName),!0):n(g,[],!0))}),Pe(()=>{if(e(u)&&e(b)&&e(u)!==e(b)){const Q=`${e(u)}->${e(b)}`,L=m().get(Q);L&&(n(x,L.status,!0),n(I,[...L.refs],!0),L.separatingFunctionIds?n(g,[...L.separatingFunctionIds],!0):L.separatingFunctions?n(g,L.separatingFunctions.map(H=>H.shortName),!0):n(g,[],!0))}});function p(){n(u,""),n(b,""),n(x,""),n(S,""),n(I,[],!0),n(g,[],!0)}function y(Q){e(I).includes(Q)?n(I,e(I).filter(L=>L!==Q),!0):n(I,[...e(I),Q],!0)}function h(Q){e(g).includes(Q)?n(g,e(g).filter(L=>L!==Q),!0):n(g,[...e(g),Q],!0)}var O=Ve(),te=Ke(O);{var ae=Q=>{var L=sr();L.__click=[fa,p,t];var H=i(L);H.__click=[Wn];var $=o(i(H),2),ne=i($),G=i(ne),E=o(i(G),2),f=i(E);f.value=f.__value="";var R=o(f);ue(R,17,()=>t.languages,ce,(K,Y)=>{var V=Jn(),we=i(V,!0);r(V);var Z={};C(()=>{N(we,e(Y).name),Z!==(Z=e(Y).id)&&(V.value=(V.__value=e(Y).id)??"")}),_(K,V)}),r(E),r(G);var U=o(G,2),M=o(i(U),2),W=i(M);W.value=W.__value="";var z=o(W);ue(z,17,()=>t.languages,ce,(K,Y)=>{var V=Yn(),we=i(V,!0);r(V);var Z={};C(()=>{V.disabled=e(Y).id===e(u),N(we,e(Y).name),Z!==(Z=e(Y).id)&&(V.value=(V.__value=e(Y).id)??"")}),_(K,V)}),r(M),r(U),r(ne);var re=o(ne,2),oe=o(i(re),2),xe=i(oe);xe.value=xe.__value="";var be=o(xe);ue(be,17,()=>t.statusOptions,ce,(K,Y)=>{var V=Zn(),we=i(V,!0);r(V);var Z={};C(()=>{N(we,e(Y).label),Z!==(Z=e(Y).value)&&(V.value=(V.__value=e(Y).value)??"")}),_(K,V)}),r(oe);var ee=o(oe,2);{var _e=K=>{const Y=j(()=>t.statusOptions.find(de=>de.value===e(x)));var V=Ve(),we=Ke(V);{var Z=de=>{var ke=$n(),P=i(ke,!0);r(ke),C(()=>N(P,e(Y).description)),_(de,ke)};B(we,de=>{e(Y)&&de(Z)})}_(K,V)};B(ee,K=>{e(x)&&K(_e)})}r(re);var ge=o(re,2),J=o(i(ge),2);mt(J),r(ge);var se=o(ge,2);{var ve=K=>{var Y=ar(),V=o(i(Y),2);ue(V,21,c,ce,(we,Z)=>{var de=tr();de.__click=[er,y,Z];var ke=i(de,!0);r(de),C(P=>{Be(de,1,P),N(ke,e(Z))},[()=>`px-3 py-1 text-sm rounded-lg border-2 transition-colors ${e(I).includes(e(Z))?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-300"}`]),_(we,de)}),r(V),r(Y),_(K,Y)};B(se,K=>{c().length>0&&K(ve)})}var le=o(se,2);{var Te=K=>{var Y=or(),V=o(i(Y),2);ue(V,21,v,ce,(de,ke)=>{var P=rr();P.__click=[nr,h,ke];var q=i(P,!0);r(P),C(De=>{Be(P,1,De),ze(P,"title",e(ke).name),N(q,e(ke).shortName)},[()=>`px-3 py-1 text-sm rounded-lg border-2 transition-colors ${e(g).includes(e(ke).shortName)?"bg-orange-600 text-white border-orange-600":"bg-white text-gray-700 border-gray-300 hover:border-orange-300"}`]),_(de,P)}),r(V);var we=o(V,2);{var Z=de=>{var ke=ir(),P=i(ke);r(ke),C(q=>N(P,`Selected: ${q??""}`),[()=>e(g).join(", ")]),_(de,ke)};B(we,de=>{e(g).length>0&&de(Z)})}r(Y),_(K,Y)};B(le,K=>{v().length>0&&K(Te)})}var Ee=o(le,2),Oe=i(Ee);Oe.__click=[fa,p,t];var Me=o(Oe,2);Me.__click=[Gn,u,b,x,t,S,I,g,p,l],r(Ee),r($),r(H),r(L),C(()=>Me.disabled=!e(u)||!e(b)||!e(x)||e(u)===e(b)),ot(E,()=>e(u),K=>n(u,K)),ot(M,()=>e(b),K=>n(b,K)),ot(oe,()=>e(x),K=>n(x,K)),Ue(J,()=>e(S),K=>n(S,K)),_(Q,L)};B(te,Q=>{l()&&Q(ae)})}_(s,O),Xe()}nt(["click"]);function dr(s){const t=s.match(/author\s*=\s*[{"']([^}"']+)[}"']/i);let l="Unknown";if(t){const u=t[1].split(/\s+and\s+/i)[0].trim();if(u.includes(","))l=u.split(",")[0].trim();else{const b=u.trim().split(/\s+/);l=b[b.length-1]}l=l.replace(/[{}]/g,"").trim()}const c=s.match(/year\s*=\s*[{"']?(\d{4})[}"']?/i),v=c?c[1]:"XXXX";return{author:l,year:v}}function ht(s,t){const l=dr(s);if(!l){let u="Reference_Unknown",b=1;for(;t.has(u);)u=`Reference_Unknown_${b}`,b++;return u}const c=`${l.author}_${l.year}`;if(!t.has(c))return c;const v="abcdefghijklmnopqrstuvwxyz".split("");for(const u of v){const b=`${c}_${u}`;if(!t.has(b))return b}let m=1;for(;t.has(`${c}_${m}`);)m++;return`${c}_${m}`}function bt(s){let t=2166136261;for(let c=0;c<s.length;c++)t^=s.charCodeAt(c),t=Math.imul(t,16777619);return`lang_${(t>>>0).toString(16).padStart(8,"0")}`}function Ze(s,t){return`${s}->${t}`}function ur(s){const t=new Map,{languageIds:l,matrix:c}=s;for(let v=0;v<l.length;v++)for(let m=0;m<l.length;m++){const u=c[v][m];if(u){const b=l[v],x=l[m];let S,I=[];u.separatingFunctionIds&&Array.isArray(u.separatingFunctionIds)?S=[...u.separatingFunctionIds]:u.separatingFunctions&&Array.isArray(u.separatingFunctions)&&(I=u.separatingFunctions.map(g=>({shortName:g.shortName,name:g.name,description:g.description,refs:[...g.refs]}))),t.set(Ze(b,x),{status:u.status,refs:u.refs?[...u.refs]:[],separatingFunctionIds:S,separatingFunctions:I})}}return t}function yt(s,t){const l=s.map(m=>m.id),c=new Set(l),v=t.map(m=>{const u=ht(m,c);return c.add(u),u});return[...l,...v]}function cr(s,t,l){const c=s.map(u=>({id:u.id,name:u.name})),v=t.map(u=>({id:bt(u.name),name:u.name})),m=l.map(u=>({id:bt(u.name),name:u.name}));return[...c,...v,...m]}function gr(s){return{name:s.name,fullName:s.fullName||"",description:s.description||"",descriptionRefs:s.descriptionRefs||[],queries:s.properties?.queries||{},transformations:s.properties?.transformations||{},tags:(s.tags||[]).map(t=>({...t,color:t.color||"#6366f1"})),existingReferences:s.references?.map(t=>t.id)||[]}}function vr(s,t){const l=s.map(v=>({shortName:v.shortName,name:v.name,description:v.description})),c=t.map(v=>({shortName:v.shortName,name:v.name,description:v.description}));return[...l,...c]}var fr=k('<span class="text-sm font-bold text-gray-900"> </span>'),br=k('<span class="text-sm text-gray-600">( <!> )</span>'),mr=(s,t)=>t.onToggleExpand(t.index),pr=(s,t)=>t.onEdit(t.index),xr=(s,t)=>t.onDelete(t.index),_r=k("<div><!></div>"),yr=k('<div><div class="flex items-center justify-between"><div class="flex items-center gap-2"><span> </span> <!> <!></div> <div class="flex items-center gap-2"><button type="button"> </button> <button type="button" class="px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-800 rounded border border-blue-300" aria-label="Edit">Edit</button> <button type="button" class="px-2 py-1 text-xs bg-red-100 hover:bg-red-200 text-red-800 rounded border border-red-300" aria-label="Delete">Delete</button></div></div> <!></div>');function wt(s,t){He(t,!0);let l=pe(t,"colorScheme",3,"purple"),c=pe(t,"isExpanded",3,!1),v=pe(t,"renderMathTitle",3,!0),m=pe(t,"renderMathSubtitle",3,!0);const b={purple:{border:"border-purple-300",bg:"bg-purple-50",text:"text-purple-800",button:"bg-purple-100 hover:bg-purple-200 text-purple-800 border-purple-300",divider:"border-purple-200"},orange:{border:"border-orange-300",bg:"bg-orange-50",text:"text-orange-800",button:"bg-orange-100 hover:bg-orange-200 text-orange-800 border-orange-300",divider:"border-orange-200"},green:{border:"border-green-300",bg:"bg-green-50",text:"text-green-800",button:"bg-green-100 hover:bg-green-200 text-green-800 border-green-300",divider:"border-green-200"},yellow:{border:"border-yellow-300",bg:"bg-yellow-50",text:"text-yellow-800",button:"bg-yellow-100 hover:bg-yellow-200 text-yellow-800 border-yellow-300",divider:"border-yellow-200"},blue:{border:"border-blue-300",bg:"bg-blue-50",text:"text-blue-800",button:"bg-blue-100 hover:bg-blue-200 text-blue-800 border-blue-300",divider:"border-blue-200"}}[l()];var x=yr(),S=i(x),I=i(S),g=i(I),p=i(g);r(g);var y=o(g,2);{var h=f=>{Je(f,{get text(){return t.title},className:"text-sm font-bold text-gray-900"})},O=f=>{var R=fr(),U=i(R,!0);r(R),C(()=>N(U,t.title)),_(f,R)};B(y,f=>{v()?f(h):f(O,!1)})}var te=o(y,2);{var ae=f=>{var R=br(),U=o(i(R));{var M=z=>{Je(z,{get text(){return t.subtitle},className:"inline"})},W=z=>{var re=sn();C(()=>N(re,t.subtitle)),_(z,re)};B(U,z=>{m()?z(M):z(W,!1)})}at(),r(R),_(f,R)};B(te,f=>{t.subtitle&&f(ae)})}r(I);var Q=o(I,2),L=i(Q);L.__click=[mr,t];var H=i(L,!0);r(L);var $=o(L,2);$.__click=[pr,t];var ne=o($,2);ne.__click=[xr,t],r(Q),r(S);var G=o(S,2);{var E=f=>{var R=_r(),U=i(R);{var M=W=>{var z=Ve(),re=Ke(z);ln(re,()=>t.children),_(W,z)};B(U,W=>{t.children&&W(M)})}r(R),C(()=>Be(R,1,`mt-4 pt-4 border-t ${b.divider??""}`)),_(f,R)};B(G,f=>{c()&&f(E)})}r(x),C(()=>{Be(x,1,`border-2 ${b.border??""} ${b.bg??""} rounded-lg p-3`),Be(g,1,`text-sm font-semibold ${b.text??""}`),N(p,`${t.type??""}:`),Be(L,1,`px-2 py-1 text-xs ${b.button??""} rounded border`),ze(L,"aria-label",c()?"Collapse":"Expand"),N(H,c()?"Collapse":"Expand")}),_(s,x),Xe()}nt(["click"]);var hr=k('<div class="text-gray-500 text-xs"> </div>'),wr=k('<div class="bg-white p-2 rounded border"><div class="font-medium"> </div> <div class="text-gray-600"> </div> <!> <!></div>'),Er=k('<div><div class="font-semibold text-gray-700 mb-1"> </div> <div class="grid grid-cols-2 gap-2"></div></div>'),kr=k('<div class="text-gray-500 text-xs"> </div>'),Rr=k('<div class="bg-white p-2 rounded border"><div class="font-medium"> </div> <div class="text-gray-600"> </div> <!> <!></div>'),Sr=k('<div><div class="font-semibold text-gray-700 mb-1"> </div> <div class="grid grid-cols-2 gap-2"></div></div>'),Ir=k('<div class="bg-white p-2 rounded border"><div class="font-medium"> </div> <div class="text-gray-600"> </div></div>'),Fr=k('<div><div class="font-semibold text-gray-700 mb-1"> </div> <div class="space-y-2"></div></div>'),Tr=k('<div class="space-y-3 text-xs"><div><div class="font-semibold text-gray-700 mb-1">Full Name:</div> <!></div> <div><div class="font-semibold text-gray-700 mb-1">Description:</div> <!></div> <!> <!> <!></div>');function ba(s,t){He(t,!0);let l=pe(t,"isExpanded",3,!1),c=pe(t,"isEdit",3,!1);const v=c()?"yellow":"green";{const m=b=>{var x=Tr(),S=i(x),I=o(i(S),2);Je(I,{get text(){return t.language.fullName},className:"text-gray-900 block"}),r(S);var g=o(S,2),p=o(i(g),2);Je(p,{get text(){return t.language.description},className:"text-gray-900 block"}),r(g);var y=o(g,2);{var h=L=>{var H=Er(),$=i(H),ne=i($);r($);var G=o($,2);ue(G,21,()=>Object.entries(t.language.queries),ce,(E,f)=>{var R=j(()=>da(e(f),2));let U=()=>e(R)[0],M=()=>e(R)[1];var W=wr(),z=i(W),re=i(z,!0);r(z);var oe=o(z,2),xe=i(oe,!0);r(oe);var be=o(oe,2);{var ee=J=>{Je(J,{get text(){return M().note},className:"text-gray-500 italic text-xs block"})};B(be,J=>{M().note&&J(ee)})}var _e=o(be,2);{var ge=J=>{var se=hr(),ve=i(se);r(se),C(le=>N(ve,`Refs: [${le??""}]`),[()=>M().refs.join(", ")]),_(J,se)};B(_e,J=>{M().refs.length>0&&J(ge)})}r(W),C(()=>{N(re,U()),N(xe,M().polytime)}),_(E,W)}),r(G),r(H),C(E=>N(ne,`Query Support (${E??""}):`),[()=>Object.keys(t.language.queries).length]),_(L,H)};B(y,L=>{t.language.queries&&Object.keys(t.language.queries).length>0&&L(h)})}var O=o(y,2);{var te=L=>{var H=Sr(),$=i(H),ne=i($);r($);var G=o($,2);ue(G,21,()=>Object.entries(t.language.transformations),ce,(E,f)=>{var R=j(()=>da(e(f),2));let U=()=>e(R)[0],M=()=>e(R)[1];var W=Rr(),z=i(W),re=i(z,!0);r(z);var oe=o(z,2),xe=i(oe,!0);r(oe);var be=o(oe,2);{var ee=J=>{Je(J,{get text(){return M().note},className:"text-gray-500 italic text-xs block"})};B(be,J=>{M().note&&J(ee)})}var _e=o(be,2);{var ge=J=>{var se=kr(),ve=i(se);r(se),C(le=>N(ve,`Refs: [${le??""}]`),[()=>M().refs.join(", ")]),_(J,se)};B(_e,J=>{M().refs.length>0&&J(ge)})}r(W),C(()=>{N(re,U()),N(xe,M().polytime)}),_(E,W)}),r(G),r(H),C(E=>N(ne,`Transformation Support (${E??""}):`),[()=>Object.keys(t.language.transformations).length]),_(L,H)};B(O,L=>{t.language.transformations&&Object.keys(t.language.transformations).length>0&&L(te)})}var ae=o(O,2);{var Q=L=>{var H=Fr(),$=i(H),ne=i($);r($);var G=o($,2);ue(G,21,()=>t.language.tags,ce,(E,f)=>{var R=Ir(),U=i(R),M=i(U,!0);r(U);var W=o(U,2),z=i(W,!0);r(W),r(R),C(()=>{N(M,e(f).label),N(z,e(f).description||"No description")}),_(E,R)}),r(G),r(H),C(()=>N(ne,`Tags (${t.language.tags.length??""}):`)),_(L,H)};B(ae,L=>{t.language.tags.length>0&&L(Q)})}r(x),_(b,x)};let u=j(()=>c()?"Edit Language":"New Language");wt(s,{get type(){return e(u)},get title(){return t.language.name},get subtitle(){return t.language.description},get colorScheme(){return v},get index(){return t.index},get isExpanded(){return l()},get onToggleExpand(){return t.onToggleExpand},get onEdit(){return t.onEdit},get onDelete(){return t.onDelete},children:m,$$slots:{default:!0}})}Xe()}var Dr=k('<pre class="text-xs bg-white p-2 rounded border border-purple-200 overflow-x-auto"> </pre>');function Ar(s,t){let l=pe(t,"isExpanded",3,!1);wt(s,{type:"Reference",get title(){return`new-${t.index??""}`},renderMathTitle:!1,renderMathSubtitle:!1,colorScheme:"purple",get index(){return t.index},get isExpanded(){return l()},get onToggleExpand(){return t.onToggleExpand},get onEdit(){return t.onEdit},get onDelete(){return t.onDelete},children:v=>{var m=Dr(),u=i(m,!0);r(m),C(()=>N(u,t.reference)),_(v,m)},$$slots:{default:!0}})}var Nr=k('<div><span class="text-xs font-semibold text-gray-700">Description:</span> <!></div>'),Lr=k('<div><span class="text-xs font-semibold text-gray-700">References:</span> <span class="text-xs text-gray-600 ml-2"> </span></div>'),Mr=k('<div class="space-y-2"><div><span class="text-xs font-semibold text-gray-700">Short Name:</span> <!></div> <div><span class="text-xs font-semibold text-gray-700">Full Name:</span> <!></div> <!> <!></div>');function Or(s,t){He(t,!0),wt(s,{type:"SF",get title(){return t.separatingFunction.shortName},get subtitle(){return t.separatingFunction.name},colorScheme:"orange",get index(){return t.index},get isExpanded(){return t.isExpanded},get onToggleExpand(){return t.onToggleExpand},get onEdit(){return t.onEdit},get onDelete(){return t.onDelete},children:c=>{var v=Mr(),m=i(v),u=o(i(m),2);Je(u,{get text(){return t.separatingFunction.shortName},className:"text-xs text-gray-900 ml-2 inline"}),r(m);var b=o(m,2),x=o(i(b),2);Je(x,{get text(){return t.separatingFunction.name},className:"text-xs text-gray-900 ml-2 inline"}),r(b);var S=o(b,2);{var I=y=>{var h=Nr(),O=o(i(h),2);Je(O,{get text(){return t.separatingFunction.description},className:"text-xs text-gray-700 mt-1 block"}),r(h),_(y,h)};B(S,y=>{t.separatingFunction.description&&y(I)})}var g=o(S,2);{var p=y=>{var h=Lr(),O=o(i(h),2),te=i(O,!0);r(O),r(h),C(ae=>N(te,ae),[()=>t.separatingFunction.refs.join(", ")]),_(y,h)};B(g,y=>{t.separatingFunction.refs&&t.separatingFunction.refs.length>0&&y(p)})}r(v),_(c,v)},$$slots:{default:!0}}),Xe()}var jr=k('<div class="text-gray-500 text-xs mt-1"> </div>'),Cr=k('<div class="bg-white p-2 rounded border"><div class="font-medium"> </div> <div class="text-gray-600 text-xs"> </div> <div class="text-gray-500 italic text-xs"> </div> <!></div>'),qr=k('<div><div class="font-semibold text-gray-700 mb-1"> </div> <div class="space-y-2"></div></div>'),Ur=k('<div><div class="font-semibold text-gray-700 mb-1">References:</div> <div class="text-gray-600"> </div></div>'),Pr=k('<div class="space-y-3 text-xs"><div><div class="font-semibold text-gray-700 mb-1">Transformation Status:</div> <div class="bg-white p-2 rounded border"><span class="font-mono text-gray-900"> </span></div></div> <!> <!></div>');function Br(s,t){He(t,!0);let l=pe(t,"isExpanded",3,!1),c=pe(t,"isModified",3,!1);const v=new Map(t.languages.map(p=>[p.id,p.name])),m=Ze(t.relationship.sourceId,t.relationship.targetId),u=v.get(t.relationship.sourceId)??t.relationship.sourceId,b=v.get(t.relationship.targetId)??t.relationship.targetId,x=`${u} → ${b}`;var S=Ve(),I=Ke(S);{var g=p=>{wt(p,{type:"Relationship",get title(){return x},get subtitle(){return t.relationship.status},colorScheme:"blue",get index(){return t.index},get isExpanded(){return l()},get onToggleExpand(){return t.onToggleExpand},onEdit:()=>t.onEdit(t.index),onDelete:()=>t.onDelete(t.index,m),children:h=>{var O=Pr(),te=i(O),ae=o(i(te),2),Q=i(ae),L=i(Q,!0);r(Q),r(ae),r(te);var H=o(te,2);{var $=E=>{var f=qr(),R=i(f),U=i(R);r(R);var M=o(R,2);ue(M,21,()=>t.relationship.separatingFunctions,ce,(W,z)=>{var re=Cr(),oe=i(re),xe=i(oe,!0);r(oe);var be=o(oe,2),ee=i(be);r(be);var _e=o(be,2),ge=i(_e,!0);r(_e);var J=o(_e,2);{var se=ve=>{var le=jr(),Te=i(le);r(le),C(Ee=>N(Te,`Refs: [${Ee??""}]`),[()=>e(z).refs.join(", ")]),_(ve,le)};B(J,ve=>{e(z).refs&&e(z).refs.length>0&&ve(se)})}r(re),C(()=>{N(xe,e(z).name),N(ee,`Short: ${e(z).shortName??""}`),N(ge,e(z).description)}),_(W,re)}),r(M),r(f),C(()=>N(U,`Separating Functions (${t.relationship.separatingFunctions.length??""}):`)),_(E,f)};B(H,E=>{t.relationship.separatingFunctions&&t.relationship.separatingFunctions.length>0&&E($)})}var ne=o(H,2);{var G=E=>{var f=Ur(),R=o(i(f),2),U=i(R,!0);r(R),r(f),C(M=>N(U,M),[()=>t.relationship.refs.join(", ")]),_(E,f)};B(ne,E=>{t.relationship.refs&&t.relationship.refs.length>0&&E(G)})}r(O),C(()=>N(L,t.relationship.status)),_(h,O)},$$slots:{default:!0}})};B(I,p=>{c()&&p(g)})}_(s,S),Xe()}var Qr=k('<div class="text-center py-8 text-gray-500 italic">No changes queued yet. Use the buttons below to add items.</div>'),zr=k(`<div class="space-y-3"><h2 class="text-lg font-bold text-gray-900">Queued Changes</h2> <p class="text-sm text-gray-600">Items you've added will appear here.</p> <div class="space-y-2"><!> <!> <!> <!> <!> <!></div></div>`);function Kr(s,t){He(t,!0);const l=j(()=>t.languagesToAdd.length>0||t.languagesToEdit.length>0||t.newReferences.length>0||t.newSeparatingFunctions.length>0||t.relationships.filter(p=>t.modifiedRelations.has(Ze(p.sourceId,p.targetId))).length>0);var c=zr(),v=o(i(c),4),m=i(v);ue(m,17,()=>t.newReferences,ce,(p,y,h)=>{{let O=j(()=>t.expandedReferenceIndex===h);Ar(p,{get reference(){return e(y)},index:h,get isExpanded(){return e(O)},get onToggleExpand(){return t.onToggleExpandReference},get onEdit(){return t.onEditReference},get onDelete(){return t.onDeleteReference}})}});var u=o(m,2);ue(u,17,()=>t.newSeparatingFunctions,ce,(p,y,h)=>{{let O=j(()=>t.expandedSeparatingFunctionIndex===h);Or(p,{get separatingFunction(){return e(y)},index:h,get isExpanded(){return e(O)},get onToggleExpand(){return t.onToggleExpandSeparatingFunction},get onEdit(){return t.onEditSeparatingFunction},get onDelete(){return t.onDeleteSeparatingFunction}})}});var b=o(u,2);ue(b,17,()=>t.languagesToAdd,ce,(p,y,h)=>{{let O=j(()=>t.expandedLanguageToAddIndex===h);ba(p,{get language(){return e(y)},index:h,get isExpanded(){return e(O)},isEdit:!1,get onToggleExpand(){return t.onToggleExpandLanguageToAdd},get onEdit(){return t.onEditLanguageToAdd},get onDelete(){return t.onDeleteLanguageToAdd}})}});var x=o(b,2);ue(x,17,()=>t.languagesToEdit,ce,(p,y,h)=>{{let O=j(()=>t.expandedLanguageToEditIndex===h);ba(p,{get language(){return e(y)},index:h,get isExpanded(){return e(O)},isEdit:!0,get onToggleExpand(){return t.onToggleExpandLanguageToEdit},get onEdit(){return t.onEditLanguageToEdit},get onDelete(){return t.onDeleteLanguageToEdit}})}});var S=o(x,2);ue(S,17,()=>t.relationships,ce,(p,y,h)=>{const O=j(()=>t.modifiedRelations.has(Ze(e(y).sourceId,e(y).targetId)));{let te=j(()=>t.expandedRelationshipIndex===h);Br(p,{get languages(){return t.languages},get relationship(){return e(y)},index:h,get isModified(){return e(O)},get isExpanded(){return e(te)},get onToggleExpand(){return t.onToggleExpandRelationship},get onEdit(){return t.onEditRelationship},get onDelete(){return t.onDeleteRelationship}})}});var I=o(S,2);{var g=p=>{var y=Qr();_(p,y)};B(I,p=>{e(l)||p(g)})}r(v),r(c),_(s,c),Xe()}var Vr=k('<div class="grid grid-cols-2 md:grid-cols-5 gap-3"><button type="button" class="px-3 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">New Language</button> <button type="button" class="px-3 py-3 bg-yellow-600 hover:bg-yellow-700 text-white font-medium rounded-lg transition-colors">Edit Language</button> <button type="button" class="px-3 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Relationship</button> <button type="button" class="px-3 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors">Reference</button> <button type="button" class="px-3 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors">Separator</button></div>');function Hr(s,t){var l=Vr(),c=i(l);c.__click=function(...x){t.onAddLanguage?.apply(this,x)};var v=o(c,2);v.__click=function(...x){t.onEditLanguage?.apply(this,x)};var m=o(v,2);m.__click=function(...x){t.onManageRelationships?.apply(this,x)};var u=o(m,2);u.__click=function(...x){t.onAddReference?.apply(this,x)};var b=o(u,2);b.__click=function(...x){t.onAddSeparatingFunction?.apply(this,x)},r(l),_(s,l)}nt(["click"]);var Xr=k('<div class="pt-6"><button type="submit" class="group relative w-full px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold text-lg rounded-xl hover:from-indigo-700 hover:to-purple-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0"><span class="flex items-center justify-center"><svg class="w-5 h-5 mr-2 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg> Preview Changes</span></button> <p class="text-center text-sm text-gray-500 mt-4">Preview your changes on the graph before submitting</p></div>');function Gr(s,t){let l=pe(t,"disabled",3,!1);var c=Xr(),v=i(c);at(2),r(c),C(()=>v.disabled=l()),_(s,c)}function Wr(s){const t=s.match(/@\w+\{([^,\s]+)/);return t?t[1]:null}function Ct(s,t){const l=[];for(const c of s.descriptionRefs){const v=t.get(c);v&&l.push(v)}return{id:bt(s.name),name:s.name,fullName:s.fullName,description:s.description,descriptionRefs:[...s.descriptionRefs],properties:{queries:s.queries,transformations:s.transformations},tags:s.tags,references:l}}function Jr(s,t){const l=Wa(s),c=g=>{const{adjacencyMatrix:p}=l;if(g in p.indexByLanguage)return;const y=p.languageIds.length;p.languageIds.push(g),p.indexByLanguage[g]=y;for(const h of p.matrix)h.push(null);p.matrix.push(new Array(y+1).fill(null))},v=new Map;for(const g of l.languages)if(g.references)for(const p of g.references)v.set(p.id,p);const m=new Set(v.keys()),u=new Map;if(l.separatingFunctions)for(const g of l.separatingFunctions)u.set(g.shortName,g);const b=new Set(t.modifiedRelations??[]),x=g=>{const p={shortName:g.shortName,name:g.name,description:g.description,refs:[...g.refs]};u.set(p.shortName,p),l.separatingFunctions=[...l.separatingFunctions??[],p]},S=g=>{c(g.sourceId),c(g.targetId);const p=l.adjacencyMatrix.indexByLanguage[g.sourceId],y=l.adjacencyMatrix.indexByLanguage[g.targetId];if(p===void 0||y===void 0)return;const h=`${g.sourceId}->${g.targetId}`;if(b.size>0&&!b.has(h)&&l.adjacencyMatrix.matrix[p]?.[y])return;const O=[];if(g.separatingFunctionIds&&g.separatingFunctionIds.length>0)for(const ae of g.separatingFunctionIds){const Q=u.get(ae);Q&&O.push({shortName:Q.shortName,name:Q.name,description:Q.description,refs:[...Q.refs]})}else if(g.separatingFunctions)for(const ae of g.separatingFunctions)O.push({shortName:ae.shortName,name:ae.name,description:ae.description,refs:[...ae.refs]});const te={status:g.status,description:g.description,refs:[...g.refs],separatingFunctions:O};l.adjacencyMatrix.matrix[p][y]=te};for(const g of t.entries)switch(g.kind){case"reference":{const p=g.payload,y=ht(p,m);m.add(y);const h=Wr(p),O={id:y,title:h||y,href:"",bibtex:p};v.set(y,O);break}case"separator":{x(g.payload);break}case"language:new":{const p=Ct(g.payload,v);l.languages.push(p),c(p.id);break}case"language:edit":{const p=bt(g.payload.name),y=l.languages.findIndex(h=>h.id===p);if(y===-1){const h=Ct(g.payload,v);l.languages.push(h),c(h.id)}else l.languages[y]=Ct(g.payload,v);break}case"relationship":{S(g.payload);break}}const I=Ja(l);if(!I.ok){const g=I.errors?.join("; ")??"unknown structural error";throw new Error(`Contribution queue produced an invalid dataset: ${g}`)}return Ya(l)}function ma(s,t,l){const c=!e(t);n(t,c),c&&n(l,qt(),!0)}function Yr(s,t){n(t,null)}var Zr=k('<div class="mr-auto mb-3 flex items-center gap-3 rounded-lg border border-amber-300 bg-amber-50 px-4 py-2 text-sm text-amber-800 shadow-sm"><span class="font-medium">Editing prior submission</span> <button type="button" class="rounded-md border border-amber-400 px-2 py-1 text-xs font-semibold text-amber-700 transition-colors hover:bg-amber-100">Stop</button></div>'),$r=k('<p class="text-sm text-gray-500">No saved submissions yet. Submit once to keep a snapshot.</p>'),ei=k('<div class="text-xs font-medium text-amber-600">Superseded</div>'),ti=k('<div class="text-xs font-medium text-emerald-600">Currently editing clone</div>'),ai=(s,t,l)=>t(e(l)),ni=k('<li class="rounded-md border border-gray-200 bg-white px-3 py-2 shadow-sm"><div class="flex items-start justify-between gap-3"><div class="space-y-1"><div class="text-sm font-medium text-gray-800"> </div> <div class="text-xs text-gray-600"> </div> <!></div> <button type="button" class="rounded-md border border-blue-500 px-3 py-1 text-xs font-semibold text-blue-600 transition-colors hover:bg-blue-50">Load</button></div></li>'),ri=k('<ul class="space-y-3 max-h-64 overflow-y-auto pr-1"></ul>'),ii=k('<div class="mb-6 rounded-lg border border-gray-200 bg-gradient-to-br from-gray-50 to-white p-4 shadow-sm"><div class="mb-3 flex items-center justify-between"><h3 class="text-sm font-semibold text-gray-800">Previous submissions</h3> <button type="button" class="rounded-md px-2 py-1 text-xs font-medium text-gray-500 hover:bg-gray-200/70 hover:text-gray-700">Close</button></div> <!></div>'),oi=(s,t)=>n(t,!1),si=s=>s.stopPropagation(),li=k("<option> </option>"),di=(s,t,l)=>{n(t,""),n(l,!1)},ui=(s,t,l,c)=>{e(t)&&(n(l,!1),n(c,!0))},ci=k('<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl max-w-md w-full"><div class="bg-gradient-to-r from-yellow-600 to-yellow-700 px-6 py-4"><h2 class="text-2xl font-bold text-white">Select Language to Edit</h2> <p class="text-yellow-100 mt-1">Choose an existing language</p></div> <div class="p-6"><label for="language-selector" class="block text-sm font-medium text-gray-700 mb-2">Language <span class="text-red-500">*</span></label> <select id="language-selector" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"><option>Choose a language...</option><!></select> <div class="flex gap-3 justify-end pt-4 mt-4 border-t"><button type="button" class="px-4 py-2 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">Cancel</button> <button type="button" class="px-4 py-2 bg-yellow-600 text-white font-medium rounded-lg hover:bg-yellow-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors">Edit</button></div></div></div></div>'),gi=k('<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-emerald-50 py-12 px-4 sm:px-6 lg:px-8"><div class="max-w-4xl mx-auto"><div class="text-center mb-12"><h1 class="text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">Contribute to the KC Map</h1> <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">Help improve the Knowledge Compilation Map by adding new languages or updating existing ones.</p> <p class="mt-4"><a href="https://github.com/dkahdian/kcm" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg> View on GitHub</a></p></div> <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-100"><div class="bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6"><h2 class="text-2xl font-bold text-white">Submission Form</h2> <p class="text-blue-100 mt-1">Fill out the details below to contribute</p></div> <div class="p-8 sm:p-10"><form class="space-y-8"><div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200"><h2 class="text-lg font-bold text-gray-900 mb-4">Contributor Information</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="contributor-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label> <input type="email" id="contributor-email" required class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="your.email@example.com"/></div> <div><label for="contributor-github" class="block text-sm font-medium text-gray-700 mb-1">GitHub Username (optional)</label> <input type="text" id="contributor-github" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="@username"/></div></div> <div class="mt-4"><label for="contributor-note" class="block text-sm font-medium text-gray-700 mb-1">Note (optional)</label> <textarea id="contributor-note" rows="3" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-y" placeholder="Add any clarifications or additional context for your contribution..."></textarea> <p class="mt-1 text-xs text-gray-500">This note will be included in the pull request description.</p></div></div> <div class="flex justify-end"><!> <button type="button" class="mb-3 inline-flex items-center gap-2 rounded-full border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 shadow-sm transition-colors hover:border-blue-400 hover:text-blue-600"><span aria-hidden="true">🗂️</span> Submission history <svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 4l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div> <!> <!>  <!> <!></form></div></div></div></div> <!> <!> <!> <!> <!> <!>',1);function yi(s,t){He(t,!0);const l=a=>typeof a=="string",c=a=>Array.isArray(a)?a.filter(l):[],v=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():la(),m=a=>typeof a=="string"&&a.trim().length>0?a:null;function u(a){if(!Array.isArray(a))return[];const d=[];for(const w of a){if(!w||typeof w!="object")continue;const F=w;l(F.label)&&d.push({label:F.label,color:l(F.color)?F.color:"#6366f1",description:l(F.description)?F.description:void 0,refs:c(F.refs)})}return d}const b=a=>({...a,descriptionRefs:[...a.descriptionRefs],queries:Object.fromEntries(Object.entries(a.queries).map(([d,w])=>[d,{...w,refs:[...w.refs]}])),transformations:Object.fromEntries(Object.entries(a.transformations).map(([d,w])=>[d,{...w,refs:[...w.refs]}])),tags:a.tags.map(d=>({...d,refs:[...d.refs]})),existingReferences:[...a.existingReferences]}),x=a=>({...a,description:a.description,refs:[...a.refs],separatingFunctionIds:a.separatingFunctionIds?[...a.separatingFunctionIds]:void 0,separatingFunctions:a.separatingFunctions?a.separatingFunctions.map(d=>({...d,refs:[...d.refs]})):void 0}),S=a=>({shortName:a.shortName,name:a.name,description:a.description,refs:[...a.refs]}),I=a=>{switch(a.kind){case"language:new":case"language:edit":return{...a,payload:b(a.payload)};case"relationship":return{...a,payload:x(a.payload)};case"separator":return{...a,payload:S(a.payload)};case"reference":default:return{...a,payload:a.payload}}};function g(a){if(!Array.isArray(a.queueEntries)||a.queueEntries.length===0)throw new Error("Submission history entry is missing queueEntries.");return a.queueEntries.map(I)}const p=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():la();function y(a){n(f,[...e(f),a],!0)}function h(a,d,w){n(f,e(f).map(F=>F.id===a&&F.kind===d?{...F,payload:w}:F),!0)}function O(a){n(f,e(f).filter(d=>d.id!==a),!0)}const te=a=>({...a,refs:[...a.refs]}),ae=a=>{try{return new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(new Date(a))}catch{return a}},Q=a=>{const d=[];return a.summary.languagesToAdd&&d.push(`${a.summary.languagesToAdd} new ${a.summary.languagesToAdd===1?"language":"languages"}`),a.summary.languagesToEdit&&d.push(`${a.summary.languagesToEdit} edit${a.summary.languagesToEdit===1?"":"s"}`),a.summary.relationships&&d.push(`${a.summary.relationships} relation${a.summary.relationships===1?"":"s"}`),a.summary.newReferences&&d.push(`${a.summary.newReferences} reference${a.summary.newReferences===1?"":"s"}`),d.length>0?d.join(" · "):"No changes"},L=Object.values(t.data.polytimeOptions),H=t.data.relationTypes.map(a=>({value:a.id,label:a.name,description:a.description??""})),$=ur(t.data.adjacencyMatrix);let ne=T(""),G=T(""),E=T(""),f=T(Fe([])),R=T(Fe([])),U=T(Fe([])),M=T(Fe([])),W=T(null),z=T(null),re=T(null),oe=T(null),xe=T(null),be=T(!1),ee=T(!1),_e=T(!1),ge=T(""),J=T(!1),se=T(!1),ve=T(!1),le=T(null),Te=T(null),Ee=T(null),Oe=T(null),Me=T(null),K=T(Fe(new Set)),Y=T(!1),V=T(Fe([])),we=T(Fe([])),Z=T(Fe([]));const de=j(()=>e(R).map(a=>a.payload)),ke=j(()=>e(U).map(a=>a.payload)),P=j(()=>e(V).map(a=>a.bibtex)),q=j(()=>e(we).map(a=>a.payload)),De=j(()=>e(M).map(a=>a.payload));let Re=T(""),fe=T(null),ie=T(Fe([])),Ae=T(!1);const Se=j(()=>e(f).length>0||e(Z).length>0||e(K).size>0);let je=!1;Pe(()=>{const a=e(Se);a&&!je&&!e(Re)&&n(Re,v(),!0),!a&&je&&(n(Re,v(),!0),n(fe,null)),je=a}),$a(()=>{n(ie,qt(),!0);try{const a=Za();a&&(n(f,a.entries.map(I),!0),n(Z,u(a.customTags),!0),n(K,new Set(c(a.modifiedRelations)),!0),n(Re,m(a.submissionId)??"",!0),n(fe,m(a.supersedesSubmissionId),!0));const d=localStorage.getItem(ia);if(d){const w=JSON.parse(d);l(w?.email)&&n(ne,w.email,!0),l(w?.github)&&n(G,w.github,!0),l(w?.note)&&n(E,w.note,!0)}}catch(a){console.warn("Failed to restore queued changes from storage",a)}finally{n(Y,!0)}e(Re)||n(Re,v(),!0)});function Ce(a){const d=a(e(K));n(K,new Set(d),!0)}function rt(a){const d=Ze(a.sourceId,a.targetId);Ce(w=>{const F=new Set(w);return F.add(d),F})}function Qe(a){Ce(d=>{if(!d.has(a))return d;const w=new Set(d);return w.delete(a),w})}Pe(()=>{const a=[],d=[],w=[],F=[],A=[];for(const D of e(f))switch(D.kind){case"language:new":a.push({queueEntryId:D.id,payload:b(D.payload)});break;case"language:edit":d.push({queueEntryId:D.id,payload:b(D.payload)});break;case"relationship":w.push({queueEntryId:D.id,payload:x(D.payload)});break;case"reference":F.push({queueEntryId:D.id,bibtex:D.payload});break;case"separator":A.push({queueEntryId:D.id,payload:S(D.payload)});break}n(R,a,!0),n(U,d,!0),n(M,w,!0),n(V,F,!0),n(we,A,!0)}),Pe(()=>{if(!e(Y)||!Mt)return;if(e(Re)||n(Re,v(),!0),e(f).length===0&&e(Z).length===0&&e(K).size===0){try{localStorage.removeItem(ra)}catch(w){console.warn("Failed to clear queued changes from storage",w)}n(fe,null);return}const d={entries:e(f).map(I),customTags:e(Z).map(te),modifiedRelations:Array.from(e(K)),submissionId:e(Re),supersedesSubmissionId:e(fe)??null};try{localStorage.setItem(ra,JSON.stringify(d))}catch(w){console.warn("Failed to persist queued changes",w)}}),Pe(()=>{if(!e(Y)||!Mt)return;const a={email:e(ne),github:e(G),note:e(E)};try{localStorage.setItem(ia,JSON.stringify(a))}catch(d){console.warn("Failed to persist contributor info",d)}}),Pe(()=>{if(!e(Y)||!Mt)return;if(!e(Se)){oa(null);return}const a={entries:e(f).map(I),customTags:e(Z).map(te),modifiedRelations:Array.from(e(K)),submissionId:e(Re),supersedesSubmissionId:e(fe)??null};try{const d=Jr(sa,a);oa(d)}catch(d){console.error("Failed to build preview dataset:",d)}});function $e(a){return y({id:p(),kind:"language:new",payload:b(a)}),{success:!0}}function et(a){const d=e(U).find(w=>w.payload.name===a.name);return d?h(d.queueEntryId,"language:edit",b(a)):y({id:p(),kind:"language:edit",payload:b(a)}),{success:!0}}function Ge(a){y({id:p(),kind:"reference",payload:a})}function st(a){y({id:p(),kind:"separator",payload:S(a)})}function lt(a){n(Te,a,!0),n(se,!0)}function he(a){if(e(Te)!==null){const d=e(we)[e(Te)];d&&h(d.queueEntryId,"separator",S(a)),n(Te,null)}}function Ne(a){n(le,a,!0),n(J,!0)}function Le(a){if(e(le)!==null){const d=e(V)[e(le)];d&&h(d.queueEntryId,"reference",a),n(le,null)}}function qe(a){n(Ee,a,!0),n(be,!0)}function Ie(a){if(e(Ee)!==null){const d=e(R)[e(Ee)];d&&h(d.queueEntryId,"language:new",b(a)),n(Ee,null)}return{success:!0}}function dt(a){n(Oe,a,!0),n(ee,!0)}function ut(a){if(e(Oe)!==null){const d=e(U)[e(Oe)];d&&h(d.queueEntryId,"language:edit",b(a)),n(Oe,null)}return{success:!0}}function xa(a){n(Me,a,!0),n(ve,!0)}function _a(a){if(e(Me)!==null){const d=e(M)[e(Me)];d&&(h(d.queueEntryId,"relationship",x(a)),rt(a)),n(Me,null)}}function ya(a){if(e(Me)!==null){_a(a);return}const d=Ze(a.sourceId,a.targetId),w=e(M).find(F=>Ze(F.payload.sourceId,F.payload.targetId)===d);w?h(w.queueEntryId,"relationship",x(a)):y({id:p(),kind:"relationship",payload:x(a)}),rt(a)}function ha(a){const d=e(R)[a];d&&Ut(d.queueEntryId,d.payload.name)}function wa(a){const d=e(U)[a];d&&Ut(d.queueEntryId,d.payload.name)}function Ea(a){const d=e(M)[a];d&&(O(d.queueEntryId),Qe(Ze(d.payload.sourceId,d.payload.targetId)))}function Ut(a,d){const w=bt(d),F=e(M).filter(D=>D.payload.sourceId===w||D.payload.targetId===w).map(D=>D.queueEntryId),A=new Set([a,...F]);n(f,e(f).filter(D=>!A.has(D.id)),!0),Ce(D=>{if(D.size===0)return D;const ye=new Set(D);for(const X of Array.from(ye))(X.startsWith(`${d}->`)||X.endsWith(`->${d}`))&&ye.delete(X);return ye})}function ka(a){const d=e(V)[a];if(!d)return;const w=new Set(t.data.existingReferences.map(A=>A.id));for(let A=0;A<a;A++){const D=ht(e(V)[A].bibtex,w);w.add(D)}const F=ht(d.bibtex,w);n(f,e(f).map(A=>{if(A.kind==="language:new"||A.kind==="language:edit"){if(!A.payload.descriptionRefs.includes(F))return A;const D=b(A.payload);return D.descriptionRefs=D.descriptionRefs.filter(ye=>ye!==F),{...A,payload:D}}if(A.kind==="relationship"){if(!A.payload.refs.includes(F)&&!A.payload.separatingFunctions?.some(ye=>ye.refs.includes(F)))return A;const D=x(A.payload);return D.refs=D.refs.filter(ye=>ye!==F),D.separatingFunctions&&(D.separatingFunctions=D.separatingFunctions.map(ye=>({...ye,refs:ye.refs.filter(X=>X!==F)}))),{...A,payload:D}}if(A.kind==="separator"){if(!A.payload.refs.includes(F))return A;const D=S(A.payload);return D.refs=D.refs.filter(ye=>ye!==F),{...A,payload:D}}return A}),!0),O(d.queueEntryId),n(Z,e(Z).map(A=>({...A,refs:A.refs.filter(D=>D!==F)})),!0)}function Ra(a){const d=e(we)[a];if(!d)return;const w=d.payload.shortName;O(d.queueEntryId),n(f,e(f).map(F=>{if(F.kind!=="relationship"||!F.payload.separatingFunctionIds||!F.payload.separatingFunctionIds.includes(w))return F;const A=x(F.payload);return A.separatingFunctionIds=(A.separatingFunctionIds||[]).filter(D=>D!==w),{...F,payload:A}}),!0)}function Sa(a){try{const d=a.payload;n(f,g(d),!0),n(Z,d.customTags.map(te),!0),n(K,new Set(d.modifiedRelations),!0),n(ne,d.contributor.email,!0),n(G,d.contributor.github,!0),n(E,d.contributor.note,!0),n(fe,d.submissionId,!0),n(Re,v(),!0),n(ie,qt(),!0),n(Ae,!1),n(le,null),n(Ee,null),n(Oe,null),n(Me,null),n(W,null),n(z,null),n(re,null),n(oe,null)}catch(d){console.error("Failed to load submission from history",d),alert("Unable to load this submission. It was saved before ordered queues were supported.")}}function Ia(a){a.preventDefault(),window.location.href="/"}var Pt=gi();dn(a=>{cn.title="Contribute - Knowledge Compilation Map"});var Et=Ke(Pt),Bt=i(Et),Qt=o(i(Bt),2),zt=o(i(Qt),2),kt=i(zt),Rt=i(kt),St=o(i(Rt),2),It=i(St),Kt=o(i(It),2);Ye(Kt),r(It);var Vt=o(It,2),Ht=o(i(Vt),2);Ye(Ht),r(Vt),r(St);var Xt=o(St,2),Gt=o(i(Xt),2);mt(Gt),at(2),r(Xt),r(Rt);var Ft=o(Rt,2),Wt=i(Ft);{var Fa=a=>{var d=Zr(),w=o(i(d),2);w.__click=[Yr,fe],r(d),_(a,d)};B(Wt,a=>{e(fe)&&a(Fa)})}var Tt=o(Wt,2);Tt.__click=[ma,Ae,ie];var Ta=o(i(Tt),2);r(Tt),r(Ft);var Jt=o(Ft,2);{var Da=a=>{var d=ii(),w=i(d),F=o(i(w),2);F.__click=[ma,Ae,ie],r(w);var A=o(w,2);{var D=X=>{var me=$r();_(X,me)},ye=X=>{var me=ri();ue(me,21,()=>e(ie),ce,(pt,We)=>{const ct=j(()=>Q(e(We))),tt=j(()=>ae(e(We).createdAt));var gt=ni(),vt=i(gt),Dt=i(vt),At=i(Dt),Ma=i(At,!0);r(At);var Nt=o(At,2),Oa=i(Nt,!0);r(Nt);var ja=o(Nt,2);{var Ca=it=>{var xt=ei();_(it,xt)},qa=it=>{var xt=Ve(),Pa=Ke(xt);{var Ba=Lt=>{var Qa=ti();_(Lt,Qa)};B(Pa,Lt=>{e(We).payload.submissionId===e(fe)&&Lt(Ba)},!0)}_(it,xt)};B(ja,it=>{e(We).supersededBySubmissionId?it(Ca):it(qa,!1)})}r(Dt);var Ua=o(Dt,2);Ua.__click=[ai,Sa,We],r(vt),r(gt),C(()=>{N(Ma,e(tt)),N(Oa,e(ct))}),_(pt,gt)}),r(me),_(X,me)};B(A,X=>{e(ie).length===0?X(D):X(ye,!1)})}r(d),_(a,d)};B(Jt,a=>{e(Ae)&&a(Da)})}var Yt=o(Jt,2);Kr(Yt,{get languages(){return sa.languages},get languagesToAdd(){return e(de)},get languagesToEdit(){return e(ke)},get newReferences(){return e(P)},get newSeparatingFunctions(){return e(q)},get relationships(){return e(De)},get modifiedRelations(){return e(K)},get expandedLanguageToAddIndex(){return e(W)},get expandedLanguageToEditIndex(){return e(z)},get expandedReferenceIndex(){return e(oe)},get expandedSeparatingFunctionIndex(){return e(xe)},get expandedRelationshipIndex(){return e(re)},onToggleExpandLanguageToAdd:a=>n(W,e(W)===a?null:a,!0),onToggleExpandLanguageToEdit:a=>n(z,e(z)===a?null:a,!0),onToggleExpandReference:a=>n(oe,e(oe)===a?null:a,!0),onToggleExpandSeparatingFunction:a=>n(xe,e(xe)===a?null:a,!0),onToggleExpandRelationship:a=>n(re,e(re)===a?null:a,!0),onEditLanguageToAdd:qe,onEditLanguageToEdit:dt,onDeleteLanguageToAdd:ha,onDeleteLanguageToEdit:wa,onEditReference:Ne,onDeleteReference:ka,onEditSeparatingFunction:lt,onDeleteSeparatingFunction:Ra,onEditRelationship:xa,onDeleteRelationship:a=>Ea(a)});var Zt=o(Yt,2);Hr(Zt,{onAddLanguage:()=>n(be,!0),onEditLanguage:()=>n(_e,!0),onManageRelationships:()=>n(ve,!0),onAddReference:()=>n(J,!0),onAddSeparatingFunction:()=>n(se,!0)});var Aa=o(Zt,2);{let a=j(()=>!e(Se));Gr(Aa,{get disabled(){return e(a)}})}r(kt),r(zt),r(Qt),r(Bt),r(Et);var $t=o(Et,2);{let a=j(()=>e(Ee)!==null?Ie:$e),d=j(()=>e(Ee)!==null),w=j(()=>e(Ee)!==null?e(R)[e(Ee)]?.payload:void 0),F=j(()=>Object.values(t.data.queries).map(me=>({code:me.code,name:me.label}))),A=j(()=>Object.values(t.data.transformations).map(me=>({code:me.code,name:me.label}))),D=j(()=>L.map(me=>({value:me.code,label:me.label,description:me.description||""}))),ye=j(()=>[...t.data.existingTags,...e(Z)].map(me=>({label:me.label,color:me.color||"#6366f1",description:"",refs:[]}))),X=j(()=>yt(t.data.existingReferences,e(P)));ca($t,{onClose:()=>{n(be,!1),n(Ee,null)},get onAdd(){return e(a)},get isEdit(){return e(d)},get initialData(){return e(w)},get queries(){return e(F)},get transformations(){return e(A)},get polytimeOptions(){return e(D)},get existingTags(){return e(ye)},get availableRefs(){return e(X)},get isOpen(){return e(be)},set isOpen(me){n(be,me,!0)}})}var ea=o($t,2);{let a=j(()=>e(Oe)!==null?ut:et),d=j(()=>e(Oe)!==null?e(U)[e(Oe)]?.payload:e(ge)?gr(t.data.languages.find(X=>X.name===e(ge))):void 0),w=j(()=>Object.values(t.data.queries).map(X=>({code:X.code,name:X.label}))),F=j(()=>Object.values(t.data.transformations).map(X=>({code:X.code,name:X.label}))),A=j(()=>L.map(X=>({value:X.code,label:X.label,description:X.description||""}))),D=j(()=>[...t.data.existingTags,...e(Z)].map(X=>({label:X.label,color:X.color||"#6366f1",description:"",refs:[]}))),ye=j(()=>yt(t.data.existingReferences,e(P)));ca(ea,{onClose:()=>{n(ee,!1),n(ge,""),n(Oe,null)},get onAdd(){return e(a)},isEdit:!0,get initialData(){return e(d)},get queries(){return e(w)},get transformations(){return e(F)},get polytimeOptions(){return e(A)},get existingTags(){return e(D)},get availableRefs(){return e(ye)},get isOpen(){return e(ee)},set isOpen(X){n(ee,X,!0)}})}var ta=o(ea,2);{var Na=a=>{var d=ci();d.__click=[oi,_e];var w=i(d);w.__click=[si];var F=o(i(w),2),A=o(i(F),2),D=i(A);D.value=D.__value="";var ye=o(D);ue(ye,17,()=>t.data.languages,ce,(We,ct)=>{var tt=li(),gt=i(tt,!0);r(tt);var vt={};C(()=>{N(gt,e(ct).name),vt!==(vt=e(ct).name)&&(tt.value=(tt.__value=e(ct).name)??"")}),_(We,tt)}),r(A);var X=o(A,2),me=i(X);me.__click=[di,ge,_e];var pt=o(me,2);pt.__click=[ui,ge,_e,ee],r(X),r(F),r(w),r(d),C(()=>pt.disabled=!e(ge)),ot(A,()=>e(ge),We=>n(ge,We)),_(a,d)};B(ta,a=>{e(_e)&&a(Na)})}var aa=o(ta,2);{let a=j(()=>e(le)!==null?Le:Ge),d=j(()=>e(le)!==null?e(V)[e(le)]?.bibtex??"":""),w=j(()=>e(le)!==null);Pn(aa,{onClose:()=>{n(J,!1),n(le,null)},get onAdd(){return e(a)},get initialValue(){return e(d)},get isEditMode(){return e(w)},get isOpen(){return e(J)},set isOpen(F){n(J,F,!0)}})}var na=o(aa,2);{let a=j(()=>e(Te)!==null?he:st),d=j(()=>e(Te)!==null?e(we)[e(Te)]?.payload:void 0),w=j(()=>yt(t.data.existingReferences,e(P))),F=j(()=>e(Te)!==null);Xn(na,{onClose:()=>{n(se,!1),n(Te,null)},get onAdd(){return e(a)},get initialValue(){return e(d)},get availableRefs(){return e(w)},get isEditMode(){return e(F)},get isOpen(){return e(se)},set isOpen(A){n(se,A,!0)}})}var La=o(na,2);{let a=j(()=>e(Me)!==null?e(M)[e(Me)]?.payload:void 0),d=j(()=>cr(t.data.languages,e(de),e(ke))),w=j(()=>yt(t.data.existingReferences,e(P))),F=j(()=>vr(t.data.existingSeparatingFunctions,e(q)));lr(La,{onClose:()=>{n(ve,!1),n(Me,null)},onSave:ya,get initialData(){return e(a)},get languages(){return e(d)},get statusOptions(){return H},get availableRefs(){return e(w)},get availableSeparatingFunctions(){return e(F)},get baselineRelations(){return $},get isOpen(){return e(ve)},set isOpen(A){n(ve,A,!0)}})}C(()=>Be(Ta,0,`h-3 w-3 transition-transform ${e(Ae)?"rotate-180":""}`)),un("submit",kt,Ia),Ue(Kt,()=>e(ne),a=>n(ne,a)),Ue(Ht,()=>e(G),a=>n(G,a)),Ue(Gt,()=>e(E),a=>n(E,a)),_(s,Pt),Xe()}nt(["click"]);export{yi as component,_i as universal};
